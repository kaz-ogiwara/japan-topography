const showPrefecture=()=>{let t=$("#map").width(),e=$("#map").height();$("#map").empty(),$("#table-info").empty();let o=d3.geoMercator(),n=d3.select("#map"),a=d3.geoPath().projection(o),s=n.append("g"),l=(()=>{let t=$("#select-filetype").val(),e=$("#select-prefecture").val(),o="";return"prefectures"===t?(o="../data/municipality/topojson/s0001/prefectures.json",$("#select-prefecture").prop("disabled","disabled"),$("#select-prefecture").val("00")):($("#select-prefecture").prop("disabled",""),"00"===e?("constituency"===t&&(o="../data/constituency/topojson/s0001/senkyoku289polygon.json"),"municipality"===t&&(o="../data/municipality/topojson/s0001/N03-21_210101.json")):("constituency"===t&&(o="../data/constituency/topojson/s0010/senkyoku289polygon_"+e+".json"),"municipality"===t&&(o="../data/municipality/topojson/s0010/N03-21_"+e+"_210101.json"))),o})(),c=l.split("/").slice(-1)[0].replace(".json","");d3.json(l).then(function(n){const l=topojson.feature(n,n.objects[c]);o.fitExtent([[0,0],[t,e]],l),s.selectAll("path").data(l.features).enter().append("path").attr("fill","#ffffff").attr("d",a).on("click tap touch",function(t,e){s.selectAll("path").attr("fill","#ffffff"),d3.select(this).attr("fill","yellow"),(t=>{$("#table-info").empty(),Object.keys(t.properties).map(e=>{let o="<tr><th>"+e+"</th><td>"+t.properties[e]+"</td></tr>";$("#table-info").append(o)})})(t)})});let p=d3.zoom().scaleExtent([1,2e3]).on("zoom",function(){s.selectAll("path").attr("transform",d3.event.transform)});n.transition().duration(0).call(p.transform,d3.zoomIdentity),n.call(p),$("#download-geojson").attr("href",l.replace("topojson","geojson")),$("#download-topojson").attr("href",l)};$(function(){$("select").on("change",function(){showPrefecture()}),showPrefecture()});